<script>
  /**
   * Gestisce il caricamento dinamico del form.
   * @param {string} type - Il nome del form da caricare.
   */
  function openForm(type) {
    const popupContainer = document.getElementById('popupContainer');
    popupContainer.innerHTML = '<p class="center-align" style="padding: 50px;">Caricamento in corso...</p>'; // Loader

    google.script.run
      .withSuccessHandler(function(html) {
        const popupContainer = document.getElementById('popupContainer');
        popupContainer.innerHTML = html;

        // Re-inizializza componenti Materialize se necessario
        if (window.M && typeof window.M.AutoInit === 'function') {
          M.AutoInit();
        }
      })
      .withFailureHandler(function(err) {
        console.error('Errore nel caricamento del form:', err);
        document.getElementById('popupContainer').innerHTML = `<p class="red-text center-align">Errore: ${err.message}</p>`;
      })
      .loadForm(type);
  }

  // Inizializza i componenti Materialize all'avvio della Web App
  document.addEventListener('DOMContentLoaded', function() {
    M.AutoInit();
  });
</script>